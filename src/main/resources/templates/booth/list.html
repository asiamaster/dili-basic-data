<#bs4Body>
<!-- Automatically provides/replaces `Promise` if missing or broken. -->
<script src="${contextPath}/resources/design/es6-promise.js"></script>
<script src="${contextPath}/resources/design/es6-promise.auto.js"></script>
<!-- 引入Vue -->
<script src="${contextPath}/resources/design/vue@2.6.11.js"></script>
<!-- 引入element -->
<link rel="stylesheet" href="${contextPath}/resources/design/index.css">
<script src="${contextPath}/resources/design/index.js"></script>
<script src="${contextPath}/resources/design/axios.min.js" type="text/javascript"></script>
<script src="${contextPath}/resources/design/vue-ele-form.umd.min.js"></script>

<div class="modal fade" id="_modal" data-backdrop="static" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <!--modal-lg modal-sm(默认) 通过设置mw大小调整宽度（如mw-100） modal-dialog-centered垂直居中-->
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- 标题 -->
                <h5 class="modal-title" id="exampleModalLabel">客户新增</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>
<div class="main-container container-fluid" id=app v-loading.fullscreen.lock="fullscreenLoading">

    <div class="row">
        <div class="col-2">
            <!-- treeView1 start -->
            <div id="treeView" class="pull-left ztree">
                <el-input
                        placeholder="输入关键字进行过滤"
                        v-model="filterText">
                </el-input>

                <el-tree
                        class="filter-tree"
                        v-loading="loading"
                        :expand-on-click-node="false"
                        :data="data"
                        node-key="id"
                        :highlight-current="true"
                        :props="defaultProps"
                        @node-click="nodeClick"
                        :filter-node-method="filterNode"
                        ref="tree">
                </el-tree>
            </div>
            <!-- treeView1 end -->
        </div>
        <div class="col-10">
            <form class="form collapse show" id="queryForm" role="form" >
                <div class="row  row-cols-6">
                    <div class="form-group col">
                        <label for="">资产编号</label>
                        <input type="text" class="form-control isNaturalNum" name="name" placeholder="">
                    </div>
                    <div class="form-group col">
                        <label for="">楼层</label>
                        <input type="text" class="form-control isNaturalNum" name="floor" placeholder="">
                    </div>
                    <div class="form-group col">
                        <label for="businessType">资产类型</label>
                        <select id="businessType" class="form-control input-sm" name="businessType">
                            <option value="">-- 全部 --</option>
                            <option value="1">摊位</option>
                            <option value="2">冷库</option>
                            <option value="3">公寓</option>
                        </select>
                    </div>
                    <div class="form-group col">
                        <label for="">部门</label>
                        <select id="departmentId" name="departmentId" class="form-control w-200px"></select>
                        <#bcomboProvider _id="departmentId" _provider="authDepartmentProvider" _queryParams='{emptyText:"-- 全部 --"}'/>
                    </div>
                    <div class="form-group col">
                        <label for="">使用方</label>
                        <input type="text" class="form-control" name="user" placeholder="">
                    </div>

                    <div class="form-group col-auto">
                        <label for="createdStart" class="justify-content-end mr-2 w-100px">创建时间:</label>
                        <div class="form-inline">
                            <div class="input-group">
                                <input type="text" name="startTime" id="createdStart" class="form-control laydate date"/>
                                <div class="input-group-append">
                                    <label for="createdStart" class="input-group-text fa fa-calendar"></label>
                                </div>
                            </div>&nbsp;&nbsp;至&nbsp;&nbsp;
                            <div class="input-group" id="datetimepicker3">
                                <input type="text" name="endTime" id="createdEnd" class="form-control laydate date" value=""/>
                                <div class="input-group-append">
                                    <label for="createdEnd" class="input-group-text fa fa-calendar"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-auto">
                        <label for="">数量</label>
                        <div class="form-inline">
                            <input type="number" name="startNumber" class="form-control" range="0 999999.00">
                            &nbsp;&nbsp;至&nbsp;&nbsp;
                            <input type="number" name="endNumber" class="form-control" range="0 999999.00">
                        </div>
                    </div>
                    <div class="form-group col">
                        <label for="state">状态</label>
                        <select id="state" class="form-control input-sm" name="state">
                            <option value="">-- 全部 --</option>
                            <option value="1">空闲</option>
                            <option value="2">使用中</option>
                            <option value="3">维修中</option>
                        </select>
                    </div>
                    <div class="form-group col">
                        <label for="type">性质</label>
                        <select id="type" class="form-control input-sm" name="type">
                            <option value="">-- 全部 --</option>
                            <option value="0">固定</option>
                            <option value="1">临时</option>
                        </select>
                    </div>
                    <div class="col align-self-center mt-3">
                        <div class="form-inline">
                            <button type="button" class="btn btn-outline-primary mr-2" onclick="refresh()"><i class="fa fa-refresh"></i> 清空</button>
                            <button type="button" class="btn btn-outline-primary" onclick="search()"><i class="fa fa-search"></i> 查询</button>
                        </div>
                    </div>
                </div>

            </form>
            <hr>
            <div class="row">
                <div class="col-12">
                    <div id="toolbar" class="btn-group" role="group" aria-label="Toolbar with button groups">
                        <#resource code="booth_view">
                        <button type="button" class="btn btn-primary" onclick="$.operate.view()">
                            <i class="fa fa-eye"></i>查看
                        </button>
                    </#resource>
                    <#resource code="booth_add">
                    <button id="btn_add" type="button" class="btn btn-primary" onclick="openInsertHandler()"><i class="fa fa-plus"></i> 新增
                    </button>
                </#resource>
                <#resource code="booth_edit">
                <button type="button" class="btn btn-primary" onclick="openUpdateHandler()">
                    <i class="fa fa-pencil-square-o"></i> 修改
                </button>
            </#resource>
            <#resource code="booth_split">
            <button type="button" id="btn_split" class="btn btn-primary" onclick="$.operate.split()">
                <i class="fa fa-pencil-square-o"></i> 拆分资产
            </button>
        </#resource>
        <#resource code="booth_del">
        <button type="button" class="btn btn-primary" onclick="$.operate.remove()">
            <i class="fa fa-trash-o"></i> 删除
        </button>
    </#resource>
    <#resource code="booth_export">
    <button type="button" class="btn btn-primary" onclick="bui.util.doExport('grid','queryForm')">
        <i class="fa fa-trash-o"></i> 导出
    </button>
</#resource>
    <button type="button" class="btn btn-primary" onclick="window.location.href='/booth/card.action'">
        <i class="fa fa-vcard-o"></i> 卡片模式
    </button>
</div>

<table id="dataTable" class="table" data-page-size="6" data-icons="bui.variable.icons">

</table>
</div>
</div>
        </div>

    </div>

</div>

</#bs4Body>
<script type="text/javascript">
    window.rootPath = '${contextPath}';
</script>
<!-- 通用js -->
<script src="${contextPath}/resources/bui/js/base_list.js" type="text/javascript"></script>
<!-- 遮罩层 -->
<script src="${contextPath}/resources/blockUI/jquery.blockUI.js" type="text/javascript"></script>
<script src="${contextPath}/resources/design/axios.min.js" type="text/javascript"></script>
<script src="${contextPath}/resources/design/vue-ele-form.umd.min.js"></script>

<script type="text/javascript">
    var hasView = false;
    <#resource code="booth_view">
    hasView = true;
    </#resource>
</script>
<script type="text/javascript">

    // var dataUrl = window.rootPath + "/booth/listPage.action";
    // var removeUrl = window.rootPath + "/booth/delete.action";
    // var changeStatusUrl = window.rootPath + "/booth/changeStatus.action";
    // var createUrl = window.rootPath + "/booth/add.html";
    // var viewUrl = window.rootPath + "/booth/view.html?id={id}";
    // var updateUrl = window.rootPath + "/booth/update.html?id={id}";
    // var splitUrl = window.rootPath + "/booth/split.html?id={id}";
    // var exportUrl = window.rootPath + "/BoothController/export";
    // var options = {
    //     dataUrl: dataUrl,
    //     createUrl: createUrl,
    //     updateUrl: updateUrl,
    //     changeStatusUrl: changeStatusUrl,
    //     viewUrl: viewUrl,
    //     splitUrl: splitUrl,
    //     removeUrl: removeUrl,
    //     exportUrl: exportUrl,
    //     sortName: "roleSort",
    //     modalName: "资产管理"
    // };
    //
    //
    // function formatterView(value, row, index) {
    //     if (hasView) {
    //         return '<a class="like" href="javascript:void(0)" onclick="$.operate.view(' + row.id + ')" title="Like">' + value + '</a>'
    //     } else {
    //         return row.name;
    //     }
    // }
    //
    // function formatterBusinessType(value, row, index) {
    //     if(value == 1){
    //         return "摊位"
    //     } else if(value == 2){
    //         return "冷库";
    //     } else{
    //         return "公寓";
    //     }
    // }
    //
    // function formatterType(value, row, index) {
    //     if(value == 0){
    //         return "固定"
    //     } else if(value == 1){
    //         return "临时";
    //     } else{
    //         return "";
    //     }
    // }
    //
    // function stateFormatter(value, row, index) {
    //     return row.status;
    // }

    var dataUrl = window.rootPath + "/booth/listPage.action";
    var removeUrl = window.rootPath + "/configController/deleteAll.action";
    var createUrl = window.rootPath + "/configController/add.action";
    var updateUrl = window.rootPath + "/configController/edit.action?id={id}";
    var viewUrl = window.rootPath + "/configController/view?id={id}";
    var enableUrl = window.rootPath + "/configController/enableAll.action";
    var disableUrl = window.rootPath + "/configController/disableAll.action";
    var exportUrl = window.rootPath + "/configController/export";
    var options = {
        dataUrl: dataUrl,
        createUrl: createUrl,
        updateUrl: updateUrl,
        viewUrl: viewUrl,
        dialogWidth: 500,
        dialogHeight: 730,
        enableUrl: enableUrl,
        disableUrl: disableUrl,
        removeUrl: removeUrl,
        exportUrl: exportUrl,
        sortName: "roleSort",
        modalName: "配置项",
        search: false,
        dataColumns: [
            {
                checkbox: true
            },
            {
                field: 'id',
                title: 'id'
            },
            {
                field: 'name',
                title: '资产编号'
            },
            {
                field: 'businessType',
                title: '资产类型'
            },
            {
                field: 'number',
                title: '数量'
            },
            {
                field: 'unit',
                title: '单位'
            },
            {
                field: 'area',
                title: '区域'
            },
            {
                field: 'state',
                title: '状态',
                formatter: function (value, row, index) {
                    if (value == 1) {
                        return '启用';
                    } else {
                        return '禁用';
                    }
                }
            },
            {
                field: 'marketId',
                title: '市场',
                provider: 'marketProvider'
            },
            {
                field: 'type',
                title: '分组'
            },
            /*
            参照修改注释
                    {
                            field: 'xxstate',
                            title: 'xx状态',
                            visible: false, //隐藏
                            searchable: false,//搜索
                               sortable:false,//设置true为允许列可以排序
                            order: 'asc', //排序顺序
                            formatter: function (value, row, index) {
                                var actions = [];
                                if(value==0){
                                     actions.push('<span class="label label-primary">关闭</span>');
                                }else if(value==1){
                                     actions.push('<span class="label label-danger">开启</span>');
                                }
                                  return actions.join('');
                             }
                        }
            */
        ]
    };
    $(function () {
        var oTab = $.table.oTableInit(options);
        oTab.Init();
    })

    function refresh() {
        $('#queryForm .form-control').val('');
    }

    function openInsertHandler() {
        $("#_modal").modal();
        $('#_modal .modal-body').load("/booth/add.html");
        $("#_modal").find('.modal-title').text('新增资产');
    }

    function openUpdateHandler() {
        var row = $.bs_treegrid.selectFirstColumns();
        if (null == row) {
            $.modal.alertWarning('请选中一条数据');
            return;
        }
        var url = $.bs_treegrid._option.updateUrl.replace("{id}", row.id);
        $("#_modal").modal();
        $('#_modal .modal-body').load(url);
        $("#_modal").find('.modal-title').text('修改资产');
    }

</script>

<script>
    var app = new Vue({
        el: '#app',
        watch: {
            filterText(val) {
                this.$refs.tree.filter(val);
            }
        },
        data() {
            return {
                fullscreenLoading: true,
                path: [],
                filterText: '',
                loading: true,
                data: [],
                defaultProps: {
                    children: 'children',
                    label: 'label'
                },
                parentId: 0,
                formData: {
                    area: 0
                },
            };
        },
        methods: {
            loadTree() {
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: '/district/search.action',
                    success: function (data) {
                        if (data.code != '200') {
                            app.loading = false;
                            return;
                        }
                        if (data.data) {
                            data.data.push({id: 0, name: "根目录", parent: -1});
                        }
                        app.data = toEleTree(data.data, {label: "name", pid: "parentId"});
                        if (app.data.length > 0) {
                            app.formData.area = app.data[0].id;
                            app.path.push(app.data[0].name);
                        }
                        app.$nextTick(() => {
                            // treeBox 元素的ref   value 绑定的node-key
                            app.$refs.tree.setCurrentKey(app.formData.area);
                        });


                        app.fullscreenLoading = false;
                        app.loading = false;
                    },
                    error: function () {
                        app.loading = false;
                    }
                });
            },
            filterNode(value, data) {
                if (!value) return true;
                return data.label.indexOf(value) !== -1;
            },
            nodeClick(data) {
                app.formData.area = data.id;
                app.parentId = data.parentId;
                $.bs_treegrid.refresh()
                if (data.parentId === 0) {
                    app.path = [data.name]
                } else {
                    app.path = [data.name];
                    app.data.forEach(function (it) {
                        if (it.id === data.parentId) {
                            app.path.push(it.name);
                        }
                    });
                }
            }
        }
    })

    $(function () {
        app.loadTree();
    })

    function search() {
        app.formData.area = 0;
        app.$refs.tree.setCurrentKey(app.formData.area);
        $.bs_treegrid.refresh();
    }
</script>